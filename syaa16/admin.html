<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Dashboard</title> 
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="admin_style.css"> 
</head>
<body>

    <div class="d-flex w-100">
        <div id="sidebar-container"></div>
        <div id="overlay"></div>
    
        <div id="content">
            <div id="topbar-container"></div>
            
            <main id="page-content"></main>
        </div>
    </div>
    
    <div id="scripts-container"></div>

    <script>
        // Fungsi Ajaib buat manggil semua komponen
        async function loadComponent(url, elementId) {
            try {
                const response = await fetch(url);
                if (!response.ok) { // Cek kalo filenya gak ketemu
                    throw new Error(`HTTP error! status: ${response.status} - Gagal memuat ${url}`);
                }
                const text = await response.text();
                document.getElementById(elementId).innerHTML = text;
            } catch (error) {
                console.error(error);
                // Tampilkan pesan error di halaman biar kita tau
                document.getElementById(elementId).innerHTML = `<div class="alert alert-danger">Gagal memuat komponen: ${url}</div>`;
            }
        }

        // Fungsi untuk menjalankan semua setup halaman
        async function initializePage() {
            // Muat komponen-komponen dasar secara bersamaan (biar cepet)
            await Promise.all([
                loadComponent('_sidebar.html', 'sidebar-container'),
                loadComponent('_topbar.html', 'topbar-container'),
                loadComponent('_scripts.html', 'scripts-container')
            ]);
            
            // Muat konten SPESIFIK untuk halaman dashboard ini
            await loadComponent('_content_dashboard.html', 'page-content');

            // Setelah semua HTML dimuat, jalankan JavaScript-nya
            if (typeof initPage === 'function') {
                initPage(); // Fungsi ini dari _scripts.html
            }
            if (typeof initDashboardChart === 'function') {
                initDashboardChart(); // Fungsi ini spesifik untuk chart di dashboard
            }
        }

        // Fungsi khusus untuk Chart di halaman Dashboard
        function initDashboardChart() {
            const salesCtx = document.getElementById('salesChart');
            if(salesCtx) { // Cek dulu elemennya ada atau nggak
                new Chart(salesCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['5 Dec', '10 Dec', '15 Dec', '20 Dec', '25 Dec', '30 Dec'],
                        datasets: [{
                            label: 'One-time',
                            data: [40000, 35000, 42000, 50000, 48000, 55000],
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            fill: 'origin', tension: 0.4
                        }, {
                            label: 'Recurring',
                            data: [25000, 20000, 30000, 28000, 35000, 40000],
                            borderColor: 'rgba(75, 192, 192, 1)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            fill: 'origin', tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        }
        
        // Jalankan semua saat halaman siap
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>